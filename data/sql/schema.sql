CREATE TABLE p_r_categoria (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, coste_anual BIGINT NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_cliente (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, direccion VARCHAR(255) NOT NULL, slug VARCHAR(255), UNIQUE INDEX p_r_cliente_sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_coste (id BIGINT AUTO_INCREMENT, oferta_id BIGINT NOT NULL, tipo_gasto BIGINT NOT NULL, concepto VARCHAR(255) NOT NULL, dedicacion BIGINT DEFAULT '100', importe FLOAT(9, 2) DEFAULT 0 NOT NULL, coste_anual BIGINT, INDEX tipo_gasto_idx (tipo_gasto), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_empleado (id BIGINT AUTO_INCREMENT, user_id INT NOT NULL, name VARCHAR(255) NOT NULL, apellidos VARCHAR(255) NOT NULL, email VARCHAR(255) NOT NULL, perfil BIGINT NOT NULL, INDEX perfil_idx (perfil), INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_factura (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, estado BIGINT NOT NULL, proyecto_id BIGINT NOT NULL, importe BIGINT NOT NULL, codigo VARCHAR(255) NOT NULL, fichero VARCHAR(255), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX proyecto_id_idx (proyecto_id), INDEX estado_idx (estado), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_historico (factura_id BIGINT, estado BIGINT, created_at DATETIME NOT NULL, PRIMARY KEY(factura_id, estado)) ENGINE = INNODB;
CREATE TABLE p_r_hito (id BIGINT AUTO_INCREMENT, porcentaje BIGINT NOT NULL, momento BIGINT NOT NULL, oferta_id BIGINT NOT NULL, INDEX oferta_id_idx (oferta_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_oferta (id BIGINT AUTO_INCREMENT, creador_id BIGINT NOT NULL, cliente_id BIGINT NOT NULL, titulo TEXT NOT NULL, expediente VARCHAR(255), descripcion_oferta TEXT NOT NULL, tipo_trabajo VARCHAR(255), tipo_oferta BIGINT NOT NULL, base_licitacion FLOAT(9, 2) DEFAULT 0 NOT NULL, fianza_provisional FLOAT(9, 2) DEFAULT 0 NOT NULL, tipo_facturacion VARCHAR(255) DEFAULT 'Certificaci√≥n mensual', estructura FLOAT(4, 2) DEFAULT 8 NOT NULL, financiacion FLOAT(4, 2) DEFAULT 6.5 NOT NULL, descuento INT DEFAULT '0', estado BIGINT DEFAULT '1' NOT NULL, duracion BIGINT NOT NULL, fecha_presentacion DATETIME NOT NULL, fecha_creacion DATETIME NOT NULL, fecha_actualizacion DATETIME NOT NULL, firma1 TINYINT(1) DEFAULT '0' NOT NULL, firma2 TINYINT(1) DEFAULT '0' NOT NULL, descripcion_pliego TEXT NOT NULL, claridad TINYINT(1) DEFAULT '0' NOT NULL, nuevo TINYINT(1) DEFAULT '0' NOT NULL, experiencia TINYINT(1) DEFAULT '0' NOT NULL, tiempo_elaboracion SMALLINT DEFAULT '1' NOT NULL, invitados TINYINT(1) DEFAULT '0' NOT NULL, aportacion TINYINT(1) DEFAULT '0' NOT NULL, condicionada TINYINT(1) DEFAULT '0' NOT NULL, enchufe TINYINT(1) DEFAULT '0' NOT NULL, contacto VARCHAR(255), previamente TINYINT(1) DEFAULT '0' NOT NULL, imagen SMALLINT DEFAULT '1' NOT NULL, posicion_nuestra TINYINT(1) DEFAULT '0' NOT NULL, porque_posicion VARCHAR(255), posicion_competencia TINYINT(1) DEFAULT '0' NOT NULL, porque_competencia VARCHAR(255), competidor VARCHAR(255) DEFAULT 'Emergya' NOT NULL, ventaja SMALLINT DEFAULT '1' NOT NULL, exito TINYINT(1) DEFAULT '0' NOT NULL, porque_exito VARCHAR(255), INDEX cliente_id_idx (cliente_id), INDEX creador_id_idx (creador_id), INDEX estado_idx (estado), INDEX tipo_oferta_idx (tipo_oferta), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_personal (id BIGINT AUTO_INCREMENT, tipo_gasto BIGINT NOT NULL, categoria VARCHAR(255) NOT NULL, coste_anual BIGINT NOT NULL, INDEX tipo_gasto_idx (tipo_gasto), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE p_r_proyecto (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, pedido VARCHAR(255) NOT NULL, cliente_id BIGINT NOT NULL, importe_contratacion FLOAT(9, 2) NOT NULL, forma_pago VARCHAR(255) NOT NULL, tipo_facturacion VARCHAR(255) NOT NULL, duracion BIGINT DEFAULT 0 NOT NULL, oferta_id BIGINT, responsable_id BIGINT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX oferta_id_idx (oferta_id), INDEX responsable_id_idx (responsable_id), INDEX cliente_id_idx (cliente_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE t_estado (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, slug VARCHAR(255), UNIQUE INDEX t_estado_sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE t_estado_factura (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, slug VARCHAR(255), UNIQUE INDEX t_estado_factura_sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE t_gasto (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE t_oferta (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE t_rol (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group (id INT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_group_permission (group_id INT, permission_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(group_id, permission_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_permission (id INT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_remember_key (id INT AUTO_INCREMENT, user_id INT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id, ip_address)) ENGINE = INNODB;
CREATE TABLE sf_guard_user (id INT AUTO_INCREMENT, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active TINYINT(1) DEFAULT '1', is_super_admin TINYINT(1) DEFAULT '0', last_login DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX is_active_idx_idx (is_active), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_group (user_id INT, group_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE sf_guard_user_permission (user_id INT, permission_id INT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, permission_id)) ENGINE = INNODB;
ALTER TABLE p_r_coste ADD CONSTRAINT p_r_coste_tipo_gasto_t_gasto_id FOREIGN KEY (tipo_gasto) REFERENCES t_gasto(id);
ALTER TABLE p_r_empleado ADD CONSTRAINT p_r_empleado_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id);
ALTER TABLE p_r_empleado ADD CONSTRAINT p_r_empleado_perfil_t_rol_id FOREIGN KEY (perfil) REFERENCES t_rol(id);
ALTER TABLE p_r_factura ADD CONSTRAINT p_r_factura_proyecto_id_p_r_proyecto_id FOREIGN KEY (proyecto_id) REFERENCES p_r_proyecto(id) ON DELETE CASCADE;
ALTER TABLE p_r_factura ADD CONSTRAINT p_r_factura_estado_t_estado_factura_id FOREIGN KEY (estado) REFERENCES t_estado_factura(id);
ALTER TABLE p_r_historico ADD CONSTRAINT p_r_historico_factura_id_p_r_factura_id FOREIGN KEY (factura_id) REFERENCES p_r_factura(id);
ALTER TABLE p_r_historico ADD CONSTRAINT p_r_historico_estado_t_estado_factura_id FOREIGN KEY (estado) REFERENCES t_estado_factura(id);
ALTER TABLE p_r_hito ADD CONSTRAINT p_r_hito_oferta_id_p_r_oferta_id FOREIGN KEY (oferta_id) REFERENCES p_r_oferta(id) ON DELETE CASCADE;
ALTER TABLE p_r_oferta ADD CONSTRAINT p_r_oferta_tipo_oferta_t_oferta_id FOREIGN KEY (tipo_oferta) REFERENCES t_oferta(id);
ALTER TABLE p_r_oferta ADD CONSTRAINT p_r_oferta_estado_t_estado_id FOREIGN KEY (estado) REFERENCES t_estado(id);
ALTER TABLE p_r_oferta ADD CONSTRAINT p_r_oferta_creador_id_p_r_empleado_id FOREIGN KEY (creador_id) REFERENCES p_r_empleado(id);
ALTER TABLE p_r_oferta ADD CONSTRAINT p_r_oferta_cliente_id_p_r_cliente_id FOREIGN KEY (cliente_id) REFERENCES p_r_cliente(id);
ALTER TABLE p_r_personal ADD CONSTRAINT p_r_personal_tipo_gasto_t_gasto_id FOREIGN KEY (tipo_gasto) REFERENCES t_gasto(id);
ALTER TABLE p_r_proyecto ADD CONSTRAINT p_r_proyecto_responsable_id_p_r_empleado_id FOREIGN KEY (responsable_id) REFERENCES p_r_empleado(id);
ALTER TABLE p_r_proyecto ADD CONSTRAINT p_r_proyecto_oferta_id_p_r_oferta_id FOREIGN KEY (oferta_id) REFERENCES p_r_oferta(id);
ALTER TABLE p_r_proyecto ADD CONSTRAINT p_r_proyecto_cliente_id_p_r_cliente_id FOREIGN KEY (cliente_id) REFERENCES p_r_cliente(id);
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE;
